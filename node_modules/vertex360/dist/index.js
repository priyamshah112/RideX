var superagent=require("superagent"),Promise=require("bluebird"),Vertex=require("./vertex/Vertex"),Router=require("./vertex/Router"),APIRouter=require("./vertex/APIRouter"),Controller=require("./vertex/Controller"),ConfigRouter=require("./vertex/ConfigRouter"),utils=require("./vertex/utils"),local=require("./vertex/local"),db=require("./vertex/db"),Microservice=function(e){var r=(e.site_id,function(e){if(Object.keys(process.env).forEach(function(e,r){-1!=e.indexOf("AWS_")&&delete process.env[e]}),delete process.env.PATH,delete process.env._HANDLER,delete process.env.LD_LIBRARY_PATH,delete process.env.LAMBDA_TASK_ROOT,delete process.env.LAMBDA_RUNTIME_DIR,"prod"==process.env.TURBO_ENV){var r=new Vertex(e);return r}var r=local.app(e);return r});return{express:r,app:r,router:function(){if("prod"==process.env.TURBO_ENV){var e=new Router;return e}var e=local.router();return e},fetchGlobal:function(e,r,o){return function(t,n,u){t.appSlug=t.headers["Turbo-Vertex-App"],o.globalConfig(e,r).then(function(e){t.global=e,u()}).catch(function(e){u()})}},setConfig:function(e){return function(r,o,t){r.config={cdn:"dev"==e.TURBO_ENV?null:e.TURBO_CDN,global:r.global||{}},t()}},APIRouter:APIRouter,Controller:Controller,ConfigRouter:ConfigRouter,nedbConfig:db.nedbConfig,utils:utils}};module.exports=Microservice;